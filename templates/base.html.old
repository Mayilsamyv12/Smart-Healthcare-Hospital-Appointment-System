<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Health System</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/style.css' %}?v=2.0">
</head>

<body>
    <nav class="navbar">
        <div style="display: flex; align-items: center;">
            <div class="hamburger" onclick="toggleSidebar()">‚ò∞</div>
            <a href="{% url 'home' %}" class="navbar-brand">
                <span
                    style="background: var(--primary); color: white; padding: 0.2rem 0.5rem; border-radius: 6px; margin-right: 0.2rem;">One</span>Meds
            </a>
        </div>

        <div class="nav-links" style="gap: 1.5rem;">
            {% if user.is_authenticated %}
            <a href="{% url 'profile' %}" class="nav-item">Profile</a>
            <a href="{% url 'cart_view' %}" class="nav-item">Cart</a>
            {% else %}
            <a href="{% url 'login' %}" class="btn-nav-outline">Login</a>
            <a href="{% url 'register' %}" class="btn-nav-solid">Register</a>
            {% endif %}

            <a href="{% url 'reminder_list' %}" class="nav-icon-link">
                <span class="nav-icon">üîî</span>
                <span>Reminder</span>
            </a>

            <div class="nav-location-trigger" onclick="openLocationModal()">
                <span class="nav-icon">üìç</span>
                <span>Location Select</span>
                <span style="font-size: 0.8rem; margin-left: 2px;">‚ñº</span>
            </div>

            <form action="{% url 'search' %}" method="get" class="nav-search-pill">
                <span style="color: #9ca3af; margin-right: 0.5rem;">üîç</span>
                <input type="text" name="q" placeholder="Search"
                    style="border: none; outline: none; background: transparent; width: 100px;">
            </form>
        </div>
    </nav>

    <div class="sidebar" id="sidebar">
        <div style="position: absolute; top: 20px; right: 20px; padding: 5px; cursor: pointer;"
            onclick="toggleSidebar()">
            <span style="font-size: 2rem; color: #000; line-height: 1;">&times;</span>
        </div>

        <div style="padding: 1rem;">
            <a href="{% url 'home' %}" class="nav-item" style="display:block; margin-bottom:0.5rem;">Home</a>

            <!-- Dropdowns removed for debugging -->

            <a href="{% url 'medicine_list' %}" class="nav-item"
                style="display:block; margin-bottom:0.5rem; margin-top: 0.5rem;">Medicine Orders</a>
        </div>
    </div>

    <div class="container">
        {% block content %}{% endblock %}

    </div>

    </div>

    <footer style="background: white; border-top: 1px solid #eee; padding: 2rem 0; margin-top: 4rem;">
        <div class="container"
            style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 2rem;">
            <div>
                <h3 style="color: var(--primary);">OneMeds</h3>
                <p style="color: #666; font-size: 0.9rem; margin-top: 0.5rem;">Making healthcare accessible and
                    efficient for everyone.</p>
            </div>
            <div>
                <h4>Quick Links</h4>
                <ul style="list-style: none; padding: 0; margin-top: 0.5rem;">
                    <li><a href="{% url 'about' %}"
                            style="text-decoration: none; color: #666; display: block; margin-bottom: 0.5rem;">About
                            Us</a></li>
                    <li><a href="{% url 'contact' %}"
                            style="text-decoration: none; color: #666; display: block; margin-bottom: 0.5rem;">Contact
                            Us</a></li>
                    <li><a href="{% url 'help' %}"
                            style="text-decoration: none; color: #666; display: block; margin-bottom: 0.5rem;">Help
                            Center</a></li>
                </ul>
            </div>
            <div>
                <h4>Legal</h4>
                <ul style="list-style: none; padding: 0; margin-top: 0.5rem;">
                    <li><a href="{% url 'terms' %}"
                            style="text-decoration: none; color: #666; display: block; margin-bottom: 0.5rem;">Terms &
                            Conditions</a></li>
                    <li><a href="{% url 'privacy' %}"
                            style="text-decoration: none; color: #666; display: block; margin-bottom: 0.5rem;">Privacy
                            Policy</a></li>
                </ul>
            </div>
        </div>
        <div
            style="text-align: center; margin-top: 2rem; padding-top: 2rem; border-top: 1px solid #eee; color: #999; font-size: 0.9rem;">
            &copy; 2026 OneMeds. All rights reserved.
        </div>
    </footer>

    <!-- Load dedicated location script -->
    <script src="{% static 'js/location.js' %}"></script>

    <!-- Initial State for JS -->
    <script>
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('active');
        }

        function toggleDropdown(id) {
            var content = document.getElementById(id);
            content.classList.toggle('active');

            // Optional: Rotate arrow if we add one (handled via CSS sibling selector usually or add logic here)
        }

        window.isLocationMandatory = "{{ user.is_authenticated|yesno:'true,false' }}" === "true";
        window.hasLocationSet = "{{ request.session.user_location|default:'' }}" !== "";

        // Auto-open if needed
        document.addEventListener('DOMContentLoaded', function () {
            if (window.isLocationMandatory && !window.hasLocationSet) {
                if (window.openLocationModal) window.openLocationModal();
            }
        });
    </script>

    <!-- Universal Location Modal HTML (Flipkart Style) -->
    <div id="universalLocationModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Select Location</h3>
                <button id="closeModalBtn" onclick="closeLocationModal()" class="modal-close-btn">&times;</button>
            </div>

            <div class="modal-body">
                <form action="{% url 'set_location' %}" method="post">
                    {% csrf_token %}
                    <div class="location-input-group">
                        <span class="search-icon">üîç</span>
                        <input type="text" name="location" id="universalLocationInput"
                            placeholder="Search for city, area..." required autocomplete="off">
                    </div>
                </form>

                <div class="detect-location-btn" onclick="detectLocationUniversal()">
                    <div style="font-size: 1.4rem;">üìç</div>
                    <div>
                        <div style="line-height: 1.2;">Use Current Location</div>
                        <div style="font-size: 0.8rem; font-weight: 400; color: #666; margin-top: 2px;">Using GPS</div>
                    </div>
                </div>

                {% if request.session.user_location %}
                <div class="saved-location">
                    <div style="font-size: 1.2rem; color: #999;">‚úì</div>
                    <div>
                        <div style="font-weight: 500;">{{ request.session.user_location }}</div>
                        <div style="font-size: 0.8rem; color: #999;">Selected Location</div>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</body>

</html>